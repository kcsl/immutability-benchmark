# Vagrant configuration itself
Vagrant.configure("2") do |config|
  # This VM is based on Ubuntu 12.04 64-bit
  config.vm.box = "precise64"
  config.vm.box_url = "http://files.vagrantup.com/precise64.box"

  # Give the VM 8GB of memory
  config.vm.provider :virtualbox do |vb|
    vb.customize ["modifyvm", :id, "--memory", "8192"]
  end

  # Install the Java JRE 6 and download reiminfer
  config.vm.provision :shell, inline: <<eos
    set -e
    echo "Installing some required packages in the VM"
    apt-get update -qq
    apt-get install -qq -y openjdk-6-jdk vim-tiny make wget unzip git

    cd /home/vagrant

	echo "Downloading ReImInfer..."
	wget -q https://github.com/SoftwareEngineeringToolDemos/FSE-2012-ReImInfer/raw/master/type-inference-0.1.2.zip
    unzip type-inference-0.1.2.zip

    echo "Downloading Benchmark..."
    git clone https://github.com/kcsl/immutability-benchmark.git
    
	echo "Building testcases..."
	cd immutability-benchmark/testcases
	./build-testcases.sh
	
	# run reiminfer over each testcase
	cd /type-inference-0.1.2
	
	#TESTCASE=../immutability-benchmark/testcases/source/AGT/AGT001_FinalObject_ObjectInstanceVariable/src/testcase/AGT001_FinalObject_ObjectInstanceVariable.java
	#ANNOTATIONS="../immutability-benchmark/testcases/TestcaseBase/src/annotations/MUTABLE.java ../immutability-benchmark/testcases/TestcaseBase/src/annotations/READONLY.java"
	
	#sudo ./binary/javai-reim $TESTCASE $ANNOTATIONS
eos

  # Map port 8080 in the VM to the host's port 8080
  config.vm.network "forwarded_port", guest: 8080, host: 8080, auto_correct: true
  # And 8086 to 8086
  config.vm.network "forwarded_port", guest: 8086, host: 8086, auto_correct: true

  # Alternatively you can use a static private IP, for this comment out the line above
  # and uncomment the following line
  #config.vm.network "private_network", ip: "192.168.13.22"
end
